<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VENTANA CONFIRMACION INCAPACIDAD RECIBIDA</title>
  <!-- Puedes incluir tus estilos CSS aquí -->

  <link rel="stylesheet" href="/incapacidades/css/sidebar/style_sidebar_adaptacion_pantalla.css">



  <%-include('./../partials/header/header.ejs') %>
  <%-include('./../partials/listas ID/modulos/incapacidades/lista_cie_10.ejs') %>


</head>


<body class="bg-slate-200 px-0 mx-0">


  <!-- NAVBAR -->
  <header>
    <!-- NAVBAR SUPERIOR -->
    <nav class="navbar">
      <div class="navbar-left ">
        <div class="navbar-left" style="gap: 0.5rem;">
          <img src="/incapacidades/img/logo/LOGO_SPEED_NETWORKS_SAS-01.png" alt="Logo 1" style="height: 60px;" />
          <img src="/incapacidades/img/logo/CONEXION-DIGITAL-LOGO-VECTOR-png-blanco.png" alt="Logo 2" style="height: 90px;" />
        </div>
      </div>

      <div class="navbar-right">
        <span class="navbar-user">Hola, Alex Alejandro Oviedo Gonzalez</span>
        <i class='bx bx-user-circle text-2xl ml-4'></i>
        <i class='bx bx-exit ml-4 text-xl cursor-pointer'></i>
      </div>
    </nav>
  </header>

  <!-- SIDEBAR -->
  <aside>
    <!-- SIDEBAR (partial) -->
    <div id="sidebar_principal_incapacidades" class="main-content">
      <aside id="sidebar" class="sidebar">
        <%- include('./../partials/sidebars/modulos/incapacidades/sidebar_principal.ejs') %>
      </aside>
    </div>

  </aside>

  <div class="w-full">

    <div class="flex w-full">

      <div id="container_seleccionar_empleado" class="  min-h-screen gap-6 mt-32 mr-20 p-12 w-full max-w-11/12 transition-all duration-500 container-collapsed  bg-white rounded-xl">
        <%-include('./../partials/breadcrumb/modulos/incapacidades/breadcrumb_detalle_incapacidad.ejs') %>

        <div class="max-w-7xl w-full mx-auto text-center border-b border-gray-400 pb-2 mb-4 mt-4 drop-shadow-md">
         



        <!-- DATOS EMPLEADOS -->
        <%-include('./../partials/datos_empleado/datos_empleado.ejs') %>

        
          <div class="w-full text-center border-b border-gray-300 pb-2 mb-2 drop-shadow-md"></div>



          <!-- DATOS DE LA NUEVA INCAPACIDAD REGISTRADA -->
          <div class="w-full text-center border-b border-lime-600 mt-8 mb-6 py-1 drop-shadow-md">
            <h2 class="text-sm font-bold">DATOS DE LA INCAPACIDAD</h2>
          </div>




          <!-- DETALLE NUEVA INCAPACIDAD REGISTRADA -->
          <%-include('./../partials/detalle_incapacidad/data_confirmacion_registro_incapacidad.ejs') %>




          <!-- INGRESO DATOS DE LA NUEVA INCAPACIDAD -->

          <div class="w-full text-center border-b border-gray-300 pb-2 mb-2 drop-shadow-md"></div>


          <div class="w-full container mx-auto my-2 mb-4 mt-8 p-4 border border-gray-100 rounded-xl bg-gray-50">


            <!-- DOCUMENTOS ANEXADOS -->
            <div class="w-full text-center border-b border-lime-600 mt-8 mb-6 py-1 drop-shadow-md">
              <h2 class="text-sm font-bold">DOCUMENTOS ANEXADOS</h2>
            </div>


            <div id="" class="relative w-full container mx-auto my-2 mb-4 p-4 border border-gray-100 rounded-xl bg-gray-50">

              <div class="">


                <div class="p-2 space-y-6 overflow-auto max-h-[70vh]">
                  <div class="relative overflow-x-auto drop-shadow-xl rounded-lg">
                    <table class="w-full text-xs text-center rtl:text-right text-slate-700 ">
                      <thead class="text-xs text-white uppercase  ">
                        <tr class="bg-slate-800">
                          <th scope="col" class="px-3 py-2 border border-white ">
                            Archivo
                          </th>
                          <th scope="col" class="px-3 py-2 border border-white">
                            Nombre
                          </th>
                          <th scope="col" class="px-3 py-2 border border-white whitespace-nowrap">
                            Acción
                          </th>
                          <!-- <th scope="col" class="px-3 py-3 border border-white rounded-tr-xl">
                          Ruta
                        </th> -->
                        </tr>
                      </thead>
                      <tbody>
                        <% if (datos_rutas_files && datos_rutas_files.length > 0) { %>
                        <% datos_rutas_files.forEach(function(file) { %>
                        <tr class="bg-white border-b  border-gray-200 hover:bg-gray-50 ">
                          <td class="px-3 py-1 text-center align-middle">
                            <div class="flex justify-center items-center h-full">
                              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-file-type-pdf text-red-700">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                <path d="M14 3v4a1 1 0 0 0 1 1h4" />
                                <path d="M5 12v-7a2 2 0 0 1 2 -2h7l5 5v4" />
                                <path d="M5 18h1.5a1.5 1.5 0 0 0 0 -3h-1.5v6" />
                                <path d="M17 18h2" />
                                <path d="M20 15h-3v6" />
                                <path d="M11 15v6h1a2 2 0 0 0 2 -2v-2a2 2 0 0 0 -2 -2h-1z" />
                              </svg>
                            </div>
                          </td>

                          
                          <td class="px-3 py-1"><%= file.nombre %></td>
                          <td class="px-3 py-1">
                            <a href="<%= file.ruta %>" download class="inline-flex items-center text-cyan-700 hover:text-cyan-900">
                              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-download text-cyan-800">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                <path d="M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2" />
                                <path d="M7 11l5 5l5 -5" />
                                <path d="M12 4l0 12" />
                              </svg>

                            </a>
                          </td>
                          <!-- <td class="px-3 py-1"><%= file.ruta %></td> -->
                        </tr>
                        <% }); %>
                        <% } else { %>
                        <tr>
                          <td colspan="4" class="px-3 py-3 text-center">No se encontraron archivos adjuntos.</td>
                        </tr>
                        <% } %>
                      </tbody>

                    </table>

                  </div>

                </div>

              </div>

            </div>


          </div>


        </div>
      </div>

    </div>

  </div>


  <% const ids_files = (datos_rutas_files || []).map(f => f.id_ruta_documentos); %>

  <div id="datos-clave" 
    data-id-empleado="<%= datos_incapacidad.id_empleado %>" 
    data-id-incapacidad="<%= datos_incapacidad.id_incapacidades_historial %>" 
    data-id-files='<%= JSON.stringify(ids_files) %>'
    style="display: none;"    >
   
  </div>

  


<!-- MODALS -->
  <div>
    <%-include('./../partials/modals/modulos/incapacidades/modals_edit_incapacidad_ventana_confirmacion.ejs') %>
  </div>



<!--   <script>
    document.querySelectorAll('.archivo-input').forEach(input => {
      input.addEventListener('change', function () {
        const index = this.dataset.index;
        const label = document.getElementById(`archivo-label-${index}`);
        if (this.files.length > 0) {
          label.textContent = this.files[0].name;
        } else {
          label.textContent = 'Seleccionar archivo';
        }
      });
    });
  </script> -->
  

  <script>
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("update-form");
    
        if (!form) return;
    
        const tipoIncapacidad = form.querySelector("#tipo_incapacidad");
        const enfermedadGeneralContainer = form.querySelector("#enfermedad_general_container");
        const accidenteTransitoContainer = form.querySelector("#accidente_transito_container");
        const enfermedadGeneral = form.querySelector("#enfermedad_general");
        const accidenteTransito = form.querySelector("#accidente_laboral_transito");
    
        function actualizarUIyNames() {
            const tipo = tipoIncapacidad.value;
    
            if (tipo === "EPS") {
                enfermedadGeneralContainer.classList.remove("hidden");
                accidenteTransitoContainer.classList.add("hidden");
    
                enfermedadGeneral.setAttribute("name", "select_detalle_incapacidad_eps_arl");
                accidenteTransito.removeAttribute("name");
            } else if (tipo === "ARL") {
                accidenteTransitoContainer.classList.remove("hidden");
                enfermedadGeneralContainer.classList.add("hidden");
    
                accidenteTransito.setAttribute("name", "select_detalle_incapacidad_eps_arl");
                enfermedadGeneral.removeAttribute("name");
            } else {
                enfermedadGeneralContainer.classList.add("hidden");
                accidenteTransitoContainer.classList.add("hidden");
    
                enfermedadGeneral.removeAttribute("name");
                accidenteTransito.removeAttribute("name");
            }
        }
    
        // Ejecuta esto de inmediato, para corregir el DOM que EJS ensució
        actualizarUIyNames();
    
        tipoIncapacidad.addEventListener("change", actualizarUIyNames);
    
        // Debug del formulario
        form.addEventListener("submit", function (e) {
            const fd = new FormData(form);
            console.log("📤 ENVIANDO:");
            for (let [key, value] of fd.entries()) {
                console.log(`${key}: ${value}`);
            }
        });
    });
    </script>
    
    


  <script src="/incapacidades/js/sidebar/sidebar_1.js"></script>


<!-- VALIDAR CAMPOS -->
  <script src="/incapacidades/js/edit_incapacidad_ventana_confirmacion/validacion_campos_edit_incapacidad.js"></script>


    <!-- API FETCH PARA TRANSFERIR DATOS Y ACTUALIZARLOS -->
    <script src="/incapacidades/js/edit_incapacidad_ventana_confirmacion/api_edit_incapacidad.js"></script>



  <!-- calcula la cantidad de días de incapacidad -->
  <script src="/incapacidades/js/detalle_empleado/calcular_cantidad_dias_incapacidad.js"></script>


  <!-- VERIFICAR QUE SEA PDF, CALCULAR QUE TENGA MAXIMO UN PESO DE 5MB -->
  <script src="/incapacidades/js/detalle_empleado/verificacion_pdf_peso.js"></script>

  <!-- API FETCH PARA CONSULTAR CIE 10 -->
  <script src="/incapacidades/js/detalle_empleado/api_fetch_cie_10.js"></script>
  
  
  <!-- API FETCH PARA CONSULTAR SI HAY DUPLICIDAD CON LA INCAPACIDAD -->
  <script  src="/incapacidades/js/detalle_empleado/api_fetch_duplicidad_incapacidad.js"></script>



    

</body>

</html>